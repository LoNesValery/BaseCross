/*!
@file BasePhysics.h
@brief 物理計算インターファイス
@copyright Copyright (c) 2017 WiZ Tamura Hiroki,Yamanoi Yasushi.
*/

#pragma once

namespace basecross {

	//--------------------------------------------------------------------------------------
	///	モーションタイプ
	//--------------------------------------------------------------------------------------
	enum class PsMotionType {
		MotionTypeFixed = 0,
		MotionTypeActive,
		MotionTypeKeyframe,
		MotionTypeOneWay,
		MotionTypeTrigger,
		MotionTypeCount
	};

	//--------------------------------------------------------------------------------------
	///	オブジェクト作成パラメータの親
	//--------------------------------------------------------------------------------------
	struct PsParamBase {
		PsMotionType m_MotionType;
		bsm::Quat m_Quat;
		bsm::Vec3 m_Pos;
		bsm::Vec3 m_LinearVelocity;
		bsm::Vec3 m_AngularVelocity;
		bool m_UseSleep;
		float m_Mass;
		//慣性テンソル
		bsm::Mat3x3 m_Inertia;
		float m_Restitution;
		float  m_Friction;
		PsParamBase() :
			m_Quat(),
			m_Pos(0),
			m_LinearVelocity(0),
			m_AngularVelocity(0),
			m_UseSleep(true),
			m_Mass(0.0f),
			m_Inertia(),
			m_Restitution(0.2f),
			m_Friction(0.6f)
		{}
	};


	//--------------------------------------------------------------------------------------
	///	剛体のステータス(取得用)
	//--------------------------------------------------------------------------------------
	struct PsBodyStatus {
		bsm::Vec3	m_Position;
		bsm::Quat	m_Orientation;
		bsm::Vec3	m_LinearVelocity;
		bsm::Vec3	m_AngularVelocity;
	};

	//--------------------------------------------------------------------------------------
	///	剛体のステータス(設定用)
	//--------------------------------------------------------------------------------------
	struct PsBodyUpdateStatus {
		bsm::Vec3	m_Force;
		bsm::Vec3	m_Torque;
		bsm::Vec3	m_LinearVelocity;
		bsm::Vec3	m_AngularVelocity;
		PsBodyUpdateStatus():
			m_Force(0.0f),
			m_Torque(0.0f),
			m_LinearVelocity(0.0f),
			m_AngularVelocity(0.0f)
		{}
		PsBodyUpdateStatus(const PsBodyStatus& src) :
			m_Force(0.0f),
			m_Torque(0.0f),
			m_LinearVelocity(src.m_LinearVelocity),
			m_AngularVelocity(src.m_AngularVelocity)
		{}
	};



	//--------------------------------------------------------------------------------------
	///	物理オブジェクトの親
	//--------------------------------------------------------------------------------------
	class PhysicsObject : public ObjectInterface {
	protected:
		/// 剛体インデックス
		uint16_t m_Index;
		//--------------------------------------------------------------------------------------
		/*!
		@brief	コンストラクタ
		*/
		//--------------------------------------------------------------------------------------
		explicit PhysicsObject();
		//--------------------------------------------------------------------------------------
		/*!
		@brief	デストラクタ
		*/
		//--------------------------------------------------------------------------------------
		virtual ~PhysicsObject();
		//--------------------------------------------------------------------------------------
		/*!
		@brief 初期化時のStatusの設定
		@param[in]	param	インデックス
		@return	なし
		*/
		//--------------------------------------------------------------------------------------
		void SetParamStatus(const PsParamBase& param);
	public:
		//--------------------------------------------------------------------------------------
		/*!
		@brief	剛体インデックスの取得
		@return	剛体インデックス
		*/
		//--------------------------------------------------------------------------------------
		uint16_t GetIndex() const {
			return m_Index;
		}
	};


	//--------------------------------------------------------------------------------------
	///	ボックス作成のパラメータ
	//--------------------------------------------------------------------------------------
	struct PsBoxParam : public PsParamBase {
		bsm::Vec3 m_HalfSize;
		PsBoxParam() :
			m_HalfSize(1.0f)
		{}
	};

	//--------------------------------------------------------------------------------------
	///	ボックス物理オブジェクト
	//--------------------------------------------------------------------------------------
	class PhysicsBox : public PhysicsObject {
	public:
		//--------------------------------------------------------------------------------------
		/*!
		@brief	コンストラクタ
		@param[in]	param	作成のパラメータ
		@param[in]	index	インデックス
		*/
		//--------------------------------------------------------------------------------------
		explicit PhysicsBox(const PsBoxParam& param, uint16_t index);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	デストラクタ
		*/
		//--------------------------------------------------------------------------------------
		virtual ~PhysicsBox();
		//--------------------------------------------------------------------------------------
		/*!
		@brief	初期化
		*/
		//--------------------------------------------------------------------------------------
		virtual void OnCreate()override;
		//--------------------------------------------------------------------------------------
		/*!
		@brief	初期化時のパラメータを得る
		@return	初期化時のパラメータ
		*/
		//--------------------------------------------------------------------------------------
		const PsBoxParam& GetParam() const;
	private:
		// pImplイディオム
		struct Impl;
		unique_ptr<Impl> pImpl;
	};

	//--------------------------------------------------------------------------------------
	///	球体作成のパラメータ
	//--------------------------------------------------------------------------------------
	struct PsSphereParam : public PsParamBase {
		float m_Radius;
		PsSphereParam() :
			m_Radius(1.0f)
		{}
	};

	//--------------------------------------------------------------------------------------
	///	球体物理オブジェクト
	//--------------------------------------------------------------------------------------
	class PhysicsSphere : public PhysicsObject {
	public:
		//--------------------------------------------------------------------------------------
		/*!
		@brief	コンストラクタ
		@param[in]	param	作成のパラメータ
		@param[in]	index	インデックス
		*/
		//--------------------------------------------------------------------------------------
		explicit PhysicsSphere(const PsSphereParam& param,uint16_t index);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	デストラクタ
		*/
		//--------------------------------------------------------------------------------------
		virtual ~PhysicsSphere();
		//--------------------------------------------------------------------------------------
		/*!
		@brief	初期化
		*/
		//--------------------------------------------------------------------------------------
		virtual void OnCreate()override;
		//--------------------------------------------------------------------------------------
		/*!
		@brief	初期化時のパラメータを得る
		@return	初期化時のパラメータ
		*/
		//--------------------------------------------------------------------------------------
		const PsSphereParam& GetParam() const;
	private:
		// pImplイディオム
		struct Impl;
		unique_ptr<Impl> pImpl;
	};


	//--------------------------------------------------------------------------------------
	///	カプセル作成のパラメータ
	//--------------------------------------------------------------------------------------
	struct PsCapsuleParam : public PsParamBase {
		float m_HalfLen;
		float m_Radius;
		PsCapsuleParam() :
			m_HalfLen(0.5f),
			m_Radius(0.5f)
		{}
	};

	//--------------------------------------------------------------------------------------
	///	カプセル物理オブジェクト
	//--------------------------------------------------------------------------------------
	class PhysicsCapsule : public PhysicsObject {
	public:
		//--------------------------------------------------------------------------------------
		/*!
		@brief	コンストラクタ
		@param[in]	param	作成のパラメータ
		@param[in]	index	インデックス
		*/
		//--------------------------------------------------------------------------------------
		explicit PhysicsCapsule(const PsCapsuleParam& param, uint16_t index);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	デストラクタ
		*/
		//--------------------------------------------------------------------------------------
		virtual ~PhysicsCapsule();
		//--------------------------------------------------------------------------------------
		/*!
		@brief	初期化
		*/
		//--------------------------------------------------------------------------------------
		virtual void OnCreate()override;
		//--------------------------------------------------------------------------------------
		/*!
		@brief	初期化時のパラメータを得る
		@return	初期化時のパラメータ
		*/
		//--------------------------------------------------------------------------------------
		const PsCapsuleParam& GetParam() const;
	private:
		// pImplイディオム
		struct Impl;
		unique_ptr<Impl> pImpl;
	};

	//--------------------------------------------------------------------------------------
	///	シリンダー作成のパラメータ
	//--------------------------------------------------------------------------------------
	struct PsCylinderParam : public PsParamBase {
		float m_HalfLen;
		float m_Radius;
		PsCylinderParam() :
			m_HalfLen(0.5f),
			m_Radius(0.5f)
		{}
	};

	//--------------------------------------------------------------------------------------
	///	シリンダー物理オブジェクト
	//--------------------------------------------------------------------------------------
	class PhysicsCylinder : public PhysicsObject {
	public:
		//--------------------------------------------------------------------------------------
		/*!
		@brief	コンストラクタ
		@param[in]	param	作成のパラメータ
		@param[in]	index	インデックス
		*/
		//--------------------------------------------------------------------------------------
		explicit PhysicsCylinder(const PsCylinderParam& param, uint16_t index);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	デストラクタ
		*/
		//--------------------------------------------------------------------------------------
		virtual ~PhysicsCylinder();
		//--------------------------------------------------------------------------------------
		/*!
		@brief	初期化
		*/
		//--------------------------------------------------------------------------------------
		virtual void OnCreate()override;
		//--------------------------------------------------------------------------------------
		/*!
		@brief	初期化時のパラメータを得る
		@return	初期化時のパラメータ
		*/
		//--------------------------------------------------------------------------------------
		const PsCylinderParam& GetParam() const;
	private:
		// pImplイディオム
		struct Impl;
		unique_ptr<Impl> pImpl;
	};

	//--------------------------------------------------------------------------------------
	///	ConvexMeshリソース
	//--------------------------------------------------------------------------------------
	class PsConvexMeshResource : public BaseResource {
		friend class ObjectFactory;
		//コンストラクタは直接呼び出せない
		PsConvexMeshResource(vector<VertexPositionNormalTexture>& vertices, vector<uint16_t>& indices);
	public:
		//--------------------------------------------------------------------------------------
		/*!
		@brief	PsConvexMeshResourceの作成
		@param[in]	vertices	頂点の配列
		@param[in]	indices	インデックスの配列
		@return	作成されたスマートポインタ
		*/
		//--------------------------------------------------------------------------------------
		static shared_ptr<PsConvexMeshResource> CreateMeshResource(vector<VertexPositionNormalTexture>& vertices, vector<uint16_t>& indices);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	デストラクタ
		*/
		//--------------------------------------------------------------------------------------
		virtual ~PsConvexMeshResource();
		//--------------------------------------------------------------------------------------
		/*!
		@brief	メッシュインデックスの取得
		@return	メッシュインデックス
		*/
		//--------------------------------------------------------------------------------------
		uint32_t GetMeshIndex() const;
		//--------------------------------------------------------------------------------------
		/*!
		@brief	バックアップされている頂点の取得
		@return	バックアップされている頂点
		*/
		//--------------------------------------------------------------------------------------
		const vector<VertexPositionNormalTexture>& GetVertices() const;
		//--------------------------------------------------------------------------------------
		/*!
		@brief	バックアップされているインデックスの取得
		@return	バックアップされているインデックス
		*/
		//--------------------------------------------------------------------------------------
		const vector<uint16_t>& GetIndices() const;
	private:
		// pImplイディオム
		struct Impl;
		unique_ptr<Impl> pImpl;
	};

	//--------------------------------------------------------------------------------------
	///	凸面作成のパラメータ
	//--------------------------------------------------------------------------------------
	struct PsConvexParam : public PsParamBase {
		shared_ptr<PsConvexMeshResource> m_ConvexMeshResource;
	};

	//--------------------------------------------------------------------------------------
	///	凸面物理オブジェクト(頂点指定のオブジェクト)
	//--------------------------------------------------------------------------------------
	class PhysicsConvex : public PhysicsObject {
	public:
		//--------------------------------------------------------------------------------------
		/*!
		@brief	コンストラクタ
		@param[in]	param	作成のパラメータ
		@param[in]	index	インデックス
		*/
		//--------------------------------------------------------------------------------------
		explicit PhysicsConvex(const PsConvexParam& param, uint16_t index);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	デストラクタ
		*/
		//--------------------------------------------------------------------------------------
		virtual ~PhysicsConvex();
		//--------------------------------------------------------------------------------------
		/*!
		@brief	初期化
		*/
		//--------------------------------------------------------------------------------------
		virtual void OnCreate()override;
		//--------------------------------------------------------------------------------------
		/*!
		@brief	初期化時のパラメータを得る
		@return	初期化時のパラメータ
		*/
		//--------------------------------------------------------------------------------------
		const PsConvexParam& GetParam() const;
	private:
		// pImplイディオム
		struct Impl;
		unique_ptr<Impl> pImpl;
	};

	//--------------------------------------------------------------------------------------
	///	プリミティブ合成作成のタイプ
	//--------------------------------------------------------------------------------------
	enum class PsCombinedType {
		TypeSphere = 0,
		TypeBox,
		TypeCapsule,
		TypeCylinder,
		TypeConvex,
	};

	//--------------------------------------------------------------------------------------
	///	プリミティブ合成作成のプリミティブ
	//--------------------------------------------------------------------------------------
	struct PsCombinedPrimitive {
		//タイプ
		PsCombinedType m_CombinedType;
		//Boxで使用サイズ
		bsm::Vec3 m_HalfSize;
		//Sphere,Capsule,Cylinderで使う半径
		float m_Radius;
		//Capsule,Cylinderで使う半分の長さ
		float m_HalfLen;
		//Convexで使うリソース
		shared_ptr<PsConvexMeshResource> m_ConvexMeshResource;
		//オフセット回転
		bsm::Quat m_OffsetOrientation;
		//オフセット位置
		bsm::Vec3 m_OffsetPosition;
		PsCombinedPrimitive():
			m_CombinedType(PsCombinedType::TypeSphere),
			m_HalfSize(bsm::Vec3(0.5f,0.5f,0.5f)),
			m_Radius(0.5f),
			m_HalfLen(0.5f),
			m_ConvexMeshResource(nullptr),
			m_OffsetOrientation(bsm::Quat()),
			m_OffsetPosition(0.0f)
		{}
		void reset() {
			m_CombinedType = PsCombinedType::TypeSphere;
			m_HalfSize = bsm::Vec3(0.5f, 0.5f, 0.5f);
			m_Radius = 0.5f;
			m_HalfLen = 0.5f;
			m_ConvexMeshResource = nullptr;
			m_OffsetOrientation = bsm::Quat();
			m_OffsetPosition = bsm::Vec3(0.0f);
		}
	};

	//--------------------------------------------------------------------------------------
	///	プリミティブ合成作成のパラメータ
	//--------------------------------------------------------------------------------------
	struct PsCombinedParam : public PsParamBase {
		vector<PsCombinedPrimitive> m_Primitives;
		PsCombinedParam()
		{}
		void AddPrim(const PsCombinedPrimitive& prim) {
			m_Primitives.push_back(prim);
		}
	};


	//--------------------------------------------------------------------------------------
	///	プリミティブ合成物理オブジェクト
	//--------------------------------------------------------------------------------------
	class PhysicsCombinedObject : public PhysicsObject {
	public:
		//--------------------------------------------------------------------------------------
		/*!
		@brief	コンストラクタ
		@param[in]	param	作成のパラメータ
		@param[in]	index	インデックス
		*/
		//--------------------------------------------------------------------------------------
		explicit PhysicsCombinedObject(const PsCombinedParam& param, uint16_t index);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	デストラクタ
		*/
		//--------------------------------------------------------------------------------------
		virtual ~PhysicsCombinedObject();
		//--------------------------------------------------------------------------------------
		/*!
		@brief	初期化
		*/
		//--------------------------------------------------------------------------------------
		virtual void OnCreate()override;
		//--------------------------------------------------------------------------------------
		/*!
		@brief	初期化時のパラメータを得る
		@return	初期化時のパラメータ
		*/
		//--------------------------------------------------------------------------------------
		const PsCombinedParam& GetParam() const;
	private:
		// pImplイディオム
		struct Impl;
		unique_ptr<Impl> pImpl;
	};





	//--------------------------------------------------------------------------------------
	///	物理計算用のインターフェイス
	//--------------------------------------------------------------------------------------
	class BasePhysics{
	public:
		//--------------------------------------------------------------------------------------
		/*!
		@brief	コンストラクタ
		*/
		//--------------------------------------------------------------------------------------
		explicit BasePhysics();
		//--------------------------------------------------------------------------------------
		/*!
		@brief	デストラクタ
		*/
		//--------------------------------------------------------------------------------------
		virtual ~BasePhysics();
		//--------------------------------------------------------------------------------------
		/*!
		@brief	更新
		@return	なし
		*/
		//--------------------------------------------------------------------------------------
		void Update();
		//--------------------------------------------------------------------------------------
		/*!
		@brief	初期化（すべてのオブジェクトが無くなる）
		@return	なし
		*/
		//--------------------------------------------------------------------------------------
		void Reset();
		//--------------------------------------------------------------------------------------
		/*!
		@brief	単体のボックスの追加
		@param[in]	param	作成のパラメータ
		@param[in]	index	インデックス（オブジェクトを再利用する場合）
		@return	オブジェクトのポインタ（バックアップはしないので呼び出し側で保存すること）
		*/
		//--------------------------------------------------------------------------------------
		virtual shared_ptr<PhysicsBox> AddBox(const PsBoxParam& param, uint16_t index = UINT16_MAX);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	単体の球体の追加
		@param[in]	param	作成のパラメータ
		@param[in]	index	インデックス（オブジェクトを再利用する場合）
		@return	オブジェクトのポインタ（バックアップはしないので呼び出し側で保存すること）
		*/
		//--------------------------------------------------------------------------------------
		virtual shared_ptr<PhysicsSphere> AddSphere(const PsSphereParam& param,uint16_t index = UINT16_MAX);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	単体のカプセルの追加
		@param[in]	param	作成のパラメータ
		@param[in]	index	インデックス（オブジェクトを再利用する場合）
		@return	オブジェクトのポインタ（バックアップはしないので呼び出し側で保存すること）
		*/
		//--------------------------------------------------------------------------------------
		virtual shared_ptr<PhysicsCapsule> AddCapsule(const PsCapsuleParam& param, uint16_t index = UINT16_MAX);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	単体のシリンダーの追加<br />
		シリンダーは、ボックスの縁からの落下時に不具合があるので、利用は慎重に！
		@param[in]	param	作成のパラメータ
		@param[in]	index	インデックス（オブジェクトを再利用する場合）
		@return	オブジェクトのポインタ（バックアップはしないので呼び出し側で保存すること）
		*/
		//--------------------------------------------------------------------------------------
		virtual shared_ptr<PhysicsCylinder> AddCylinder(const PsCylinderParam& param, uint16_t index = UINT16_MAX);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	凸面オブジェクトの追加
		@param[in]	param	作成のパラメータ
		@param[in]	index	インデックス（オブジェクトを再利用する場合）
		@return	オブジェクトのポインタ（バックアップはしないので呼び出し側で保存すること）
		*/
		//--------------------------------------------------------------------------------------
		virtual shared_ptr<PhysicsConvex> AddConvex(const PsConvexParam& param, uint16_t index = UINT16_MAX);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	プリミティブ合成物理オブジェクトの追加
		@param[in]	param	作成のパラメータ
		@param[in]	index	インデックス（オブジェクトを再利用する場合）
		@return	オブジェクトのポインタ（バックアップはしないので呼び出し側で保存すること）
		*/
		//--------------------------------------------------------------------------------------
		virtual shared_ptr<PhysicsCombinedObject> AddCombinedObject(const PsCombinedParam& param, uint16_t index = UINT16_MAX);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	現在のボディ数を得る
		@return	現在のボディ数
		*/
		//--------------------------------------------------------------------------------------
		uint16_t GetNumBodies() const;
		//--------------------------------------------------------------------------------------
		/*!
		@brief	剛体のステータスを得る
		@param[in]	body_index	ボディID
		@param[out]	st	ステータスを得る参照
		@return	なし
		*/
		//--------------------------------------------------------------------------------------
		void GetBodyStatus(uint16_t body_index, PsBodyStatus& st) const;
		//--------------------------------------------------------------------------------------
		/*!
		@brief	剛体のステータスを設定する
		@param[in]	body_index	ボディID
		@param[out]	st	ステータスを得る参照
		@return	なし
		*/
		//--------------------------------------------------------------------------------------
		void SetBodyStatus(uint16_t body_index,const PsBodyUpdateStatus& st);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	剛体を起こす（sleepが有効の場合）
		@param[in]	body_index	ボディID
		@return	なし
		*/
		//--------------------------------------------------------------------------------------
		void WakeUpBody(uint16_t body_index);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	剛体の位置を設定する（PsMotionTypeがMotionTypeTriggerのときのみ有効）
		@param[in]	body_index	ボディID
		@param[out]	pos	位置
		@return	なし
		*/
		//--------------------------------------------------------------------------------------
		void SetBodyPosition(uint16_t body_index, const bsm::Vec3& pos);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	剛体の速度を設定する
		@param[in]	body_index	ボディID
		@param[out]	v	速度
		@return	なし
		*/
		//--------------------------------------------------------------------------------------
		void SetBodyLinearVelocity(uint16_t body_index, const bsm::Vec3& v);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	剛体の回転速度を設定する
		@param[in]	body_index	ボディID
		@param[out]	v	速度
		@return	なし
		*/
		//--------------------------------------------------------------------------------------
		void SetBodyAngularVelocity(uint16_t body_index, const bsm::Vec3& v);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	剛体のフォースを追加する
		@param[in]	body_index	ボディID
		@param[out]	v	フォース
		@return	なし
		*/
		//--------------------------------------------------------------------------------------
		void ApplyBodyForce(uint16_t body_index, const bsm::Vec3& v);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	剛体のトルクを追加する
		@param[in]	body_index	ボディID
		@param[out]	v	トルク
		@return	なし
		*/
		//--------------------------------------------------------------------------------------
		void ApplyBodyTorque(uint16_t body_index, const bsm::Vec3& v);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	形状の数を得る
		@param[in]	body_index	ボディID
		@return	形状数
		*/
		//--------------------------------------------------------------------------------------
		uint16_t GetNumShapes(uint16_t body_index)const;
		//--------------------------------------------------------------------------------------
		/*!
		@brief	形状のオフセット回転とオフセット位置を得る
		@param[in]	body_index	ボディID
		@param[in]	shape_index	形状ID
		@param[out]	qt	回転を受ける参照
		@param[out]	pos	位置を受ける参照
		@return　なし
		*/
		//--------------------------------------------------------------------------------------
		void GetShapeOffsetQuatPos(uint16_t body_index, uint16_t shape_index, bsm::Quat& qt, bsm::Vec3& pos);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	形状のタイプを得る
		@param[in]	body_index	ボディID
		@param[in]	shape_index	形状ID
		@return　形状のタイプ
		*/
		//--------------------------------------------------------------------------------------
		sce::PhysicsEffects::ePfxShapeType GetShapeType(uint16_t body_index, uint16_t shape_index) const;
		//--------------------------------------------------------------------------------------
		/*!
		@brief	ジョイントの数を得る
		@return	ジョイント数
		*/
		//--------------------------------------------------------------------------------------
		uint16_t GetNumJoints()const;
		//--------------------------------------------------------------------------------------
		/*!
		@brief	コンタクト(衝突)の数を得る
		@return	ジョイント数
		*/
		//--------------------------------------------------------------------------------------
		uint16_t GetNumContacts()const;
		//--------------------------------------------------------------------------------------
		/*!
		@brief	指定のボディがコンタクトしている相手の配列を得る
		@param[in]	body_index	ボディID
		@param[out]	contacts	相手のIDの配列
		@return	衝突があればtrue
		*/
		//--------------------------------------------------------------------------------------
		bool GetContactsVec(uint16_t body_index, vector<uint16_t>& contacts)const;
		//--------------------------------------------------------------------------------------
		/*!
		@brief	指定のボディがコンタクトしている相手のset集合を得る
		@param[in]	body_index	ボディID
		@param[out]	contacts	相手のIDの集合
		@return	衝突があればtrue
		*/
		//--------------------------------------------------------------------------------------
		bool GetContactsSet(uint16_t body_index, set<uint16_t>& contacts)const;
		//以下慣性を計算するstatic関数
		//--------------------------------------------------------------------------------------
		/*!
		@brief	ボックス型の慣性を返す
		@param[in]	halfExtent	3方向の半分
		@param[in]	mass	質量
		@return	慣性行列
		*/
		//--------------------------------------------------------------------------------------
		static bsm::Mat3x3 CalcInertiaBox(const bsm::Vec3& halfExtent,float mass);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	球型の慣性を返す
		@param[in]	radius	半径
		@param[in]	mass	質量
		@return	慣性行列
		*/
		//--------------------------------------------------------------------------------------
		static bsm::Mat3x3 CalcInertiaSphere(float radius, float mass);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	シリンダー型（X方向に長い）の慣性を返す
		@param[in]	halfLength	半分の長さ
		@param[in]	radius	半径
		@param[in]	mass	質量
		@return	慣性行列
		*/
		//--------------------------------------------------------------------------------------
		static bsm::Mat3x3 CalcInertiaCylinderX(float halfLength, float radius, float mass);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	シリンダー型（Y方向に長い）の慣性を返す
		@param[in]	halfLength	半分の長さ
		@param[in]	radius	半径
		@param[in]	mass	質量
		@return	慣性行列
		*/
		//--------------------------------------------------------------------------------------
		static bsm::Mat3x3 CalcInertiaCylinderY(float halfLength, float radius, float mass);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	シリンダー型（Z方向に長い）の慣性を返す
		@param[in]	halfLength	半分の長さ
		@param[in]	radius	半径
		@param[in]	mass	質量
		@return	慣性行列
		*/
		//--------------------------------------------------------------------------------------
		static bsm::Mat3x3 CalcInertiaCylinderZ(float halfLength, float radius, float mass);
		//以下、直接アクセス(使用する場合は慎重に)
		//--------------------------------------------------------------------------------------
		/*!
		@brief	形状を得る
		@param[in]	body_index	ボディID
		@param[in]	shape_index	形状ID
		@return　形状の参照
		*/
		//--------------------------------------------------------------------------------------
		const sce::PhysicsEffects::PfxShape& getPfxShape(uint16_t body_index, uint16_t shape_index) const;
		sce::PhysicsEffects::PfxShape& getPfxShape(uint16_t body_index, uint16_t shape_index);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	剛体のステートを得る
		@param[in]	body_index	ボディID
		@return　剛体のステートの参照
		*/
		//--------------------------------------------------------------------------------------
		const sce::PhysicsEffects::PfxRigidState& getPfxRigidState(uint16_t body_index) const;
		sce::PhysicsEffects::PfxRigidState& getPfxRigidState(uint16_t body_index);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	剛体を得る
		@param[in]	body_index	ボディID
		@return　剛体の参照
		*/
		//--------------------------------------------------------------------------------------
		const sce::PhysicsEffects::PfxRigidBody& getPfxRigidBody(uint16_t body_index) const;
		sce::PhysicsEffects::PfxRigidBody& getPfxRigidBody(uint16_t body_index);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	衝突する剛体を得る
		@param[in]	body_index	ボディID
		@return　衝突する剛体の参照
		*/
		//--------------------------------------------------------------------------------------
		const sce::PhysicsEffects::PfxCollidable& getPfxCollidable(uint16_t body_index) const;
		sce::PhysicsEffects::PfxCollidable& getPfxCollidable(uint16_t body_index);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	剛体のソルバーを得る
		@param[in]	body_index	ボディID
		@return　剛体のソルバーの参照
		*/
		//--------------------------------------------------------------------------------------
		const sce::PhysicsEffects::PfxSolverBody& getPfxSolverBody(uint16_t body_index) const;
		sce::PhysicsEffects::PfxSolverBody& getPfxSolverBody(uint16_t body_index);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	ジョイントのペアを得る
		@param[in]	joint_index	ジョイントID
		@return　ジョイントのペアの参照
		*/
		//--------------------------------------------------------------------------------------
		const sce::PhysicsEffects::PfxConstraintPair& getPfxConstraintPair(uint16_t joint_index) const;
		sce::PhysicsEffects::PfxConstraintPair& getPfxConstraintPair(uint16_t joint_index);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	ジョイントを得る
		@param[in]	joint_index	ジョイントID
		@return　ジョイントの参照
		*/
		//--------------------------------------------------------------------------------------
		const sce::PhysicsEffects::PfxJoint& getPfxJoint(uint16_t joint_index) const;
		sce::PhysicsEffects::PfxJoint& getPfxJoint(uint16_t joint_index);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	今のブロードフェイズペアを得る
		@param[in]	contact_index	コンタクトID
		@return　今のブロードフェイズペアの参照
		*/
		//--------------------------------------------------------------------------------------
		const sce::PhysicsEffects::PfxBroadphasePair& getNowPfxBroadphasePair(uint16_t contact_index) const;
		sce::PhysicsEffects::PfxBroadphasePair& getNowPfxBroadphasePair(uint16_t contact_index);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	1つ前のブロードフェイズペアを得る
		@param[in]	contact_index	コンタクトID
		@return　1つ前のブロードフェイズペアの参照
		*/
		//--------------------------------------------------------------------------------------
		const sce::PhysicsEffects::PfxBroadphasePair& getPrevPfxBroadphasePair(uint16_t contact_index) const;
		sce::PhysicsEffects::PfxBroadphasePair& getPrevPfxBroadphasePair(uint16_t contact_index);
		//--------------------------------------------------------------------------------------
		/*!
		@brief	コンタクトのマニホールドを得る
		@param[in]	contact_index	コンタクトID
		@return　コンタクトのマニホールドの参照
		*/
		//--------------------------------------------------------------------------------------
		const sce::PhysicsEffects::PfxContactManifold& getPfxContactManifold(uint16_t contact_index) const;
		sce::PhysicsEffects::PfxContactManifold& getPfxContactManifold(uint16_t contact_index);

	};



}
//end basecross
